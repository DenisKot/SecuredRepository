≥
dC:\Users\dkote\Documents\Project\SecuredRepository\SecuredRepository\src\Persistence\AppDbContext.cs
	namespace 	
Persistence
 
{ 
public 

class 
AppDbContext 
: 
	DbContext  )
{		 
public

 
AppDbContext

 
(

 
)

 
:

 
base

  $
(

$ %
$str

% .
)

. /
{ 	
} 	
public 
AppDbContext 
( 
DbConnection (

connection) 3
)3 4
:5 6
base7 ;
(; <

connection< F
,F G
trueH L
)L M
{ 	
} 	
public 
DbSet 
< 
Employee 
> 
	Employees (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
DbSet 
< 

Permission 
>  
Permissions! ,
{- .
get/ 2
;2 3
set4 7
;7 8
}9 :
	protected 
override 
void 
OnModelCreating  /
(/ 0
DbModelBuilder0 >
modelBuilder? K
)K L
{ 	
modelBuilder 
. 
Entity 
<  
Employee  (
>( )
() *
)* +
.+ ,
Property, 4
(4 5
e5 6
=>7 9
e: ;
.; <
	FirstName< E
)E F
.F G
HasMaxLengthG S
(S T
StringLengthT `
.` a
Normala g
)g h
.h i

IsRequiredi s
(s t
)t u
;u v
modelBuilder 
. 
Entity 
<  
Employee  (
>( )
() *
)* +
.+ ,
Property, 4
(4 5
e5 6
=>7 9
e: ;
.; <

SecondName< F
)F G
.G H
HasMaxLengthH T
(T U
StringLengthU a
.a b
Normalb h
)h i
.i j

IsRequiredj t
(t u
)u v
;v w
modelBuilder 
. 
Entity 
<  
Employee  (
>( )
() *
)* +
.+ ,
Property, 4
(4 5
e5 6
=>7 9
e: ;
.; <
Surname< C
)C D
.D E
HasMaxLengthE Q
(Q R
StringLengthR ^
.^ _
Normal_ e
)e f
;f g
modelBuilder 
. 
Entity 
<  
User  $
>$ %
(% &
)& '
.' (
Property( 0
(0 1
e1 2
=>3 5
e6 7
.7 8
Name8 <
)< =
.= >
HasMaxLength> J
(J K
StringLengthK W
.W X
NormalX ^
)^ _
._ `

IsRequired` j
(j k
)k l
;l m
modelBuilder 
. 
Entity 
<  

Permission  *
>* +
(+ ,
), -
.- .
HasRequired. 9
(9 :
x: ;
=>< >
x? @
.@ A
UserA E
)E F
.F G
WithManyG O
(O P
uP Q
=>R T
uU V
.V W
PermissionsW b
)b c
;c d
} 	
} 
}   ˚
ÄC:\Users\dkote\Documents\Project\SecuredRepository\SecuredRepository\src\Persistence\Migrations\201811131025284_InitialCreate.cs
	namespace 	
Persistence
 
. 

Migrations  
{ 
public 

partial 
class 
InitialCreate &
:' (
DbMigration) 4
{ 
public 
override 
void 
Up 
(  
)  !
{		 	
CreateTable

 
(

 
$str 
,  
c 
=> 
new 
{ 
Id 
= 
c 
. 
Int "
(" #
nullable# +
:+ ,
false- 2
,2 3
identity4 <
:< =
true> B
)B C
,C D
	FirstName !
=" #
c$ %
.% &
String& ,
(, -
nullable- 5
:5 6
false7 <
,< =
	maxLength> G
:G H
$numI L
)L M
,M N

SecondName "
=# $
c% &
.& '
String' -
(- .
nullable. 6
:6 7
false8 =
,= >
	maxLength? H
:H I
$numJ M
)M N
,N O
Surname 
=  !
c" #
.# $
String$ *
(* +
	maxLength+ 4
:4 5
$num6 9
)9 :
,: ;
} 
) 
. 

PrimaryKey 
( 
t 
=>  
t! "
." #
Id# %
)% &
;& '
} 	
public 
override 
void 
Down !
(! "
)" #
{ 	
	DropTable 
( 
$str %
)% &
;& '
} 	
} 
} î
çC:\Users\dkote\Documents\Project\SecuredRepository\SecuredRepository\src\Persistence\Migrations\201811141506219_SimplePermissionsMigration.cs
	namespace 	
Persistence
 
. 

Migrations  
{ 
public 

partial 
class &
SimplePermissionsMigration 3
:4 5
DbMigration6 A
{ 
public 
override 
void 
Up 
(  
)  !
{		 	
CreateTable

 
(

 
$str !
,! "
c 
=> 
new 
{ 
Id 
= 
c 
. 
Int "
(" #
nullable# +
:+ ,
false- 2
,2 3
identity4 <
:< =
true> B
)B C
,C D
Name 
= 
c  
.  !
String! '
(' (
)( )
,) *
User_Id 
=  !
c" #
.# $
Int$ '
(' (
nullable( 0
:0 1
false2 7
)7 8
,8 9
} 
) 
. 

PrimaryKey 
( 
t 
=>  
t! "
." #
Id# %
)% &
. 

ForeignKey 
( 
$str '
,' (
t) *
=>+ -
t. /
./ 0
User_Id0 7
,7 8
cascadeDelete9 F
:F G
trueH L
)L M
. 
Index 
( 
t 
=> 
t 
. 
User_Id %
)% &
;& '
CreateTable 
( 
$str 
, 
c 
=> 
new 
{ 
Id 
= 
c 
. 
Int "
(" #
nullable# +
:+ ,
false- 2
,2 3
identity4 <
:< =
true> B
)B C
,C D
Name 
= 
c  
.  !
String! '
(' (
nullable( 0
:0 1
false2 7
,7 8
	maxLength9 B
:B C
$numD G
)G H
,H I
} 
) 
. 

PrimaryKey 
( 
t 
=>  
t! "
." #
Id# %
)% &
;& '
} 	
public!! 
override!! 
void!! 
Down!! !
(!!! "
)!!" #
{"" 	
DropForeignKey## 
(## 
$str## ,
,##, -
$str##. 7
,##7 8
$str##9 D
)##D E
;##E F
	DropIndex$$ 
($$ 
$str$$ '
,$$' (
new$$) ,
[$$, -
]$$- .
{$$/ 0
$str$$1 :
}$$; <
)$$< =
;$$= >
	DropTable%% 
(%% 
$str%% !
)%%! "
;%%" #
	DropTable&& 
(&& 
$str&& '
)&&' (
;&&( )
}'' 	
}(( 
})) £
pC:\Users\dkote\Documents\Project\SecuredRepository\SecuredRepository\src\Persistence\Migrations\Configuration.cs
	namespace 	
Persistence
 
. 

Migrations  
{ 
internal

 
sealed

 
class

 
Configuration

 '
:

( )%
DbMigrationsConfiguration

* C
<

C D
Persistence

D O
.

O P
AppDbContext

P \
>

\ ]
{ 
public 
Configuration 
( 
) 
{ 	&
AutomaticMigrationsEnabled &
=' (
false) .
;. /
} 	
	protected 
override 
void 
Seed  $
($ %
Persistence% 0
.0 1
AppDbContext1 =
context> E
)E F
{ 	
context 
. 
	Employees 
. 
Add !
(! "
new" %
Employee& .
{ 
	FirstName 
= 
$str #
,# $

SecondName 
= 
$str &
,& '
Surname 
= 
$str )
} 
) 
; 
context 
. 
	Employees 
. 
Add !
(! "
new" %
Employee& .
{ 
	FirstName 
= 
$str #
,# $

SecondName 
= 
$str %
,% &
Surname 
= 
$str '
} 
) 
; 
context!! 
.!! 
SaveChanges!! 
(!!  
)!!  !
;!!! "
}"" 	
}## 
}$$ ê
iC:\Users\dkote\Documents\Project\SecuredRepository\SecuredRepository\src\Persistence\PersistenceModule.cs
	namespace 	
Persistence
 
{		 
public

 

class

 
PersistenceModule

 "
{ 
public 
static 
void 
	Configure $
($ %
	Container% .
	container/ 8
)8 9
{ 	
	container 
. 
Register 
< 
AppDbContext +
>+ ,
(, -
(- .
). /
=>0 2
new3 6
AppDbContext7 C
(C D
)D E
,E F
newG J
WebRequestLifestyleK ^
(^ _
)_ `
)` a
;a b
	container 
. 
Register 
< 
IUnitOfWork *
,* +

UnitOfWork, 6
.6 7

UnitOfWork7 A
>A B
(B C
newC F
WebRequestLifestyleG Z
(Z [
)[ \
)\ ]
;] ^
	container 
. 
Register 
< 
IRepository *
<* +
Employee+ 3
>3 4
,4 5

Repository6 @
<@ A
EmployeeA I
>I J
>J K
(K L
)L M
;M N
	container 
. 
Register 
< 
IRepository *
<* +

Permission+ 5
>5 6
,6 7

Repository8 B
<B C

PermissionC M
>M N
>N O
(O P
)P Q
;Q R
	container 
. 
Register 
< 
IRepository *
<* +
User+ /
>/ 0
,0 1

Repository2 <
<< =
User= A
>A B
>B C
(C D
)D E
;E F
} 	
} 
} ö
oC:\Users\dkote\Documents\Project\SecuredRepository\SecuredRepository\src\Persistence\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str &
)& '
]' (
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str (
)( )
]) *
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *Å0
mC:\Users\dkote\Documents\Project\SecuredRepository\SecuredRepository\src\Persistence\Repository\Repository.cs
	namespace 	
Persistence
 
. 

Repository  
{		 
public

 

class

 

Repository

 
<

 
TEntity

 #
>

# $
:

% &
IRepository

' 2
<

2 3
TEntity

3 :
>

: ;
where 
TEntity 
: 

BaseEntity "
{ 
	protected 
AppDbContext 
context &
;& '
	protected 
DbSet 
< 
TEntity 
>  
dbSet! &
;& '
public 

Repository 
( 
AppDbContext &
context' .
). /
{ 	
this 
. 
context 
= 
context "
;" #
this 
. 
dbSet 
= 
context  
.  !
Set! $
<$ %
TEntity% ,
>, -
(- .
). /
;/ 0
} 	
public 
virtual 
IEnumerable "
<" #
TEntity# *
>* +
Get, /
(/ 0

Expression 
< 
Func 
< 
TEntity #
,# $
bool% )
>) *
>* +
filter, 2
=3 4
null5 9
,9 :
Func 
< 

IQueryable 
< 
TEntity #
># $
,$ %
IOrderedQueryable& 7
<7 8
TEntity8 ?
>? @
>@ A
orderByB I
=J K
nullL P
,P Q
string 
includeProperties $
=% &
$str' )
)) *
{ 	

IQueryable 
< 
TEntity 
> 
query  %
=& '
this( ,
., -
dbSet- 2
;2 3
if 
( 
filter 
!= 
null 
) 
{ 
query 
= 
query 
. 
Where #
(# $
filter$ *
)* +
;+ ,
}   
foreach"" 
("" 
var"" 
includeProperty"" (
in"") +
includeProperties"", =
.""= >
Split""> C
(## 
new## 
char## 
[## 
]## 
{## 
$char## !
}##" #
,### $
StringSplitOptions##% 7
.##7 8
RemoveEmptyEntries##8 J
)##J K
)##K L
{$$ 
query%% 
=%% 
query%% 
.%% 
Include%% %
(%%% &
includeProperty%%& 5
)%%5 6
;%%6 7
}&& 
if(( 
((( 
orderBy(( 
!=(( 
null(( 
)((  
{)) 
return** 
orderBy** 
(** 
query** $
)**$ %
.**% &
ToList**& ,
(**, -
)**- .
;**. /
}++ 
return-- 
query-- 
.-- 
ToList-- 
(--  
)--  !
;--! "
}.. 	
public00 
virtual00 
TEntity00 
GetById00 &
(00& '
object00' -
id00. 0
)000 1
{11 	
return22 
this22 
.22 
dbSet22 
.22 
Find22 "
(22" #
id22# %
)22% &
;22& '
}33 	
public55 
virtual55 
void55 
Insert55 "
(55" #
TEntity55# *
entity55+ 1
)551 2
{66 	
this77 
.77 
dbSet77 
.77 
Add77 
(77 
entity77 !
)77! "
;77" #
}88 	
public:: 
virtual:: 
void:: 
Delete:: "
(::" #
object::# )
id::* ,
)::, -
{;; 	
TEntity<< 
entityToDelete<< "
=<<# $
this<<% )
.<<) *
dbSet<<* /
.<</ 0
Find<<0 4
(<<4 5
id<<5 7
)<<7 8
;<<8 9
this== 
.== 
Delete== 
(== 
entityToDelete== &
)==& '
;==' (
}>> 	
public@@ 
virtual@@ 
void@@ 
Delete@@ "
(@@" #
TEntity@@# *
entityToDelete@@+ 9
)@@9 :
{AA 	
ifBB 
(BB 
thisBB 
.BB 
contextBB 
.BB 
EntryBB "
(BB" #
entityToDeleteBB# 1
)BB1 2
.BB2 3
StateBB3 8
==BB9 ;
EntityStateBB< G
.BBG H
DetachedBBH P
)BBP Q
{CC 
thisDD 
.DD 
dbSetDD 
.DD 
AttachDD !
(DD! "
entityToDeleteDD" 0
)DD0 1
;DD1 2
}EE 
thisGG 
.GG 
dbSetGG 
.GG 
RemoveGG 
(GG 
entityToDeleteGG ,
)GG, -
;GG- .
}HH 	
publicJJ 
virtualJJ 
voidJJ 
UpdateJJ "
(JJ" #
TEntityJJ# *
entityToUpdateJJ+ 9
)JJ9 :
{KK 	
thisLL 
.LL 
dbSetLL 
.LL 
AttachLL 
(LL 
entityToUpdateLL ,
)LL, -
;LL- .
thisMM 
.MM 
contextMM 
.MM 
EntryMM 
(MM 
entityToUpdateMM -
)MM- .
.MM. /
StateMM/ 4
=MM5 6
EntityStateMM7 B
.MMB C
ModifiedMMC K
;MMK L
}NN 	
}OO 
}PP √&
mC:\Users\dkote\Documents\Project\SecuredRepository\SecuredRepository\src\Persistence\UnitOfWork\UnitOfWork.cs
	namespace 	
Persistence
 
. 

UnitOfWork  
{		 
internal

 
class

 

UnitOfWork

 
:

 
IUnitOfWork

  +
{ 
private 
readonly 
AppDbContext %
context& -
;- .
private  
DbContextTransaction $ 
dbContextTransaction% 9
;9 :
private 
bool 
disposed 
= 
false  %
;% &
public 

UnitOfWork 
( 
AppDbContext &
context' .
). /
{ 	
this 
. 
context 
= 
context "
;" #
} 	
public 
void 
BeginTransaction $
($ %
)% &
{ 	
this 
.  
dbContextTransaction %
=& '
this( ,
., -
context- 4
.4 5
Database5 =
.= >
BeginTransaction> N
(N O
IsolationLevelO ]
.] ^
ReadCommitted^ k
)k l
;l m
} 	
public 
void 
EndTransaction "
(" #
)# $
{ 	
if 
( 
this 
.  
dbContextTransaction )
!=* ,
null- 1
)1 2
{ 
this 
.  
dbContextTransaction )
.) *
Commit* 0
(0 1
)1 2
;2 3
this   
.    
dbContextTransaction   )
=  * +
null  , 0
;  0 1
}!! 
}"" 	
public$$ 
void$$ 
Rollback$$ 
($$ 
)$$ 
{%% 	
if&& 
(&& 
this&& 
.&&  
dbContextTransaction&& )
!=&&* ,
null&&- 1
)&&1 2
{'' 
this(( 
.((  
dbContextTransaction(( )
.(() *
Rollback((* 2
(((2 3
)((3 4
;((4 5
this)) 
.))  
dbContextTransaction)) )
=))* +
null)), 0
;))0 1
}** 
}++ 	
public-- 
void-- 
SaveChanges-- 
(--  
)--  !
{.. 	
if// 
(// 
!// 
this// 
.// 
disposed// 
)// 
{00 
this11 
.11 
context11 
.11 
SaveChanges11 (
(11( )
)11) *
;11* +
}22 
}33 	
public55 
async55 
Task55 
SaveChangesAsync55 *
(55* +
)55+ ,
{66 	
if77 
(77 
!77 
this77 
.77 
disposed77 
)77 
{88 
await99 
this99 
.99 
context99 "
.99" #
SaveChangesAsync99# 3
(993 4
)994 5
;995 6
}:: 
};; 	
	protected== 
virtual== 
void== 
Dispose== &
(==& '
bool==' +
	disposing==, 5
)==5 6
{>> 	
if?? 
(?? 
!?? 
this?? 
.?? 
disposed?? 
)?? 
{@@ 
ifAA 
(AA 
	disposingAA 
)AA 
{BB 
contextCC 
.CC 
DisposeCC #
(CC# $
)CC$ %
;CC% &
ifEE 
(EE 
thisEE 
.EE  
dbContextTransactionEE 1
!=EE2 4
nullEE5 9
)EE9 :
{FF 
thisGG 
.GG  
dbContextTransactionGG 1
.GG1 2
CommitGG2 8
(GG8 9
)GG9 :
;GG: ;
thisHH 
.HH  
dbContextTransactionHH 1
.HH1 2
DisposeHH2 9
(HH9 :
)HH: ;
;HH; <
thisII 
.II  
dbContextTransactionII 1
=II2 3
nullII4 8
;II8 9
}JJ 
}KK 
}LL 
thisMM 
.MM 
disposedMM 
=MM 
trueMM  
;MM  !
}NN 	
publicPP 
voidPP 
DisposePP 
(PP 
)PP 
{QQ 	
DisposeRR 
(RR 
trueRR 
)RR 
;RR 
GCSS 
.SS 
SuppressFinalizeSS 
(SS  
thisSS  $
)SS$ %
;SS% &
}TT 	
}UU 
}VV 